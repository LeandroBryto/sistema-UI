<div class="page">
  <header class="header">
    <div>
      <p class="muted">Central de relatórios e análises mensais</p>
    </div>
    <div class="actions">
    </div>
  </header>

  <section class="filters card">
    <div class="row">
      <label>Mês</label>
      <input type="month" [formControl]="filtro.controls.yearMonth" />
    </div>
    <div class="row actions">
      <p-button [label]="loading ? 'Carregando...' : 'Aplicar'" severity="primary" [disabled]="loading || filtro.invalid" [loading]="loading" (onClick)="load()"></p-button>
    </div>
  </section>

  <p class="error" *ngIf="error">{{ error }}</p>

  <div class="grid two" *ngIf="report">
    <section class="card">
      <div class="metrics">
        <div class="metric">
          <span class="label">Período</span>
          <span class="value">{{ report.periodo || filtro.value.yearMonth }}</span>
        </div>
        <div class="metric">
          <span class="label">Total Receitas</span>
          <span class="value green">R$ {{ report.totalReceitas | number:'1.2-2' }}</span>
        </div>
        <div class="metric">
          <span class="label">Total Despesas</span>
          <span class="value red">R$ {{ report.totalDespesas | number:'1.2-2' }}</span>
        </div>
        <div class="metric">
          <span class="label">Saldo</span>
          <span class="value">R$ {{ report.saldo | number:'1.2-2' }}</span>
        </div>
      </div>
    </section>

    <section class="card">
      <h3 class="title">Anomalias</h3>
      <p class="muted" *ngIf="!report.analiseAnomalias">Sem registros</p>
      <p *ngIf="report.analiseAnomalias">{{ report.analiseAnomalias }}</p>
    </section>
  </div>

  <div class="grid one" *ngIf="report">
    <section class="card flex flex-column align-items-center">
      <h3 class="title w-full">Ranking Geral (Receitas e Despesas)</h3>
      <div *ngIf="mixedChartData; else noData" class="w-full flex justify-content-center" style="position: relative; height: 400px;">
        <p-chart type="doughnut" [data]="mixedChartData" [options]="doughnutOptions" width="100%" height="100%"></p-chart>
      </div>
      <ng-template #noData><p class="muted">Sem dados para exibir</p></ng-template>
    </section>
  </div>
</div>
