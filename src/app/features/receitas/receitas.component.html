<div class="page">
  <header class="header">
    <div>
      <p class="muted">Registre e acompanhe suas entradas</p>
    </div>
    <div class="summary">
      <div class="chip">Itens: {{ itens.length }}</div>
      <a class="secondary link" routerLink="/dashboard">Voltar ao Dashboard</a>
    </div>
  </header>

  <section class="filters card">
    <div class="row">
      <label>Início</label>
      <input type="date" [formControl]="filtros.controls.startDate" />
    </div>
    <div class="row">
      <label>Fim</label>
      <input type="date" [formControl]="filtros.controls.endDate" />
    </div>
    <div class="row actions">
      <p-button [label]="loading ? 'Carregando...' : 'Aplicar Filtros'" severity="primary" [disabled]="loading" [loading]="loading" (onClick)="load()"></p-button>
    </div>
  </section>

  <p class="error" *ngIf="error">{{ error }}</p>
  <p-toast position="top-right"></p-toast>

  <div class="grid two">
    <section class="card form-card">
      <h3>{{ editingId ? 'Editar Receita' : 'Nova Receita' }}</h3>
      <form [formGroup]="form" (ngSubmit)="save()">
        <div class="form-grid">
          <div class="row">
            <label>Descrição</label>
            <input type="text" formControlName="descricao" />
          </div>
          <div class="row">
            <label>Categoria</label>
            <select formControlName="categoria">
              <option value="" disabled>Selecione</option>
              <option *ngFor="let c of categorias" [value]="c">{{ c }}</option>
            </select>
          </div>
          <div class="row">
            <label>Valor</label>
            <input type="number" step="0.01" formControlName="valor" />
          </div>
          <div class="row">
            <label>Data</label>
            <input type="date" formControlName="data" />
          </div>
          <div class="row">
            <div class="field">
              <label>Forma de Recebimento</label>
              <p-dropdown [options]="formas" formControlName="formaRecebimento" placeholder="Selecione..."></p-dropdown>
            </div>
            <div class="field">
              <label>Conta de Destino</label>
              <p-dropdown [options]="carteiras" formControlName="carteiraId" optionLabel="nome" optionValue="id" placeholder="Onde o dinheiro entrou?"></p-dropdown>
            </div>
          </div>
          <div class="row checkbox">
            <label>
              <input type="checkbox" formControlName="recorrente" />
              Recorrente
            </label>
          </div>
          <div class="row wide">
            <label>Observações</label>
            <textarea rows="3" formControlName="observacoes"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button class="primary" type="submit" [disabled]="form.invalid || loading">
            {{ editingId ? 'Salvar Alterações' : 'Criar' }}
          </button>
          <button type="button" class="secondary" (click)="resetForm()">Limpar</button>
        </div>
      </form>
    </section>

    <section class="card list-card">
      <div class="list-head">
        <h3>Lista</h3>
        <input pInputText type="text" placeholder="Filtrar..." [(ngModel)]="globalFilter" (input)="dt.filterGlobal(globalFilter, 'contains')" />
      </div>
      <p-table #dt [value]="itens" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,20,50]" [responsiveLayout]="'stack'" styleClass="recipes-table">
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="descricao">Descrição <p-sortIcon field="descricao"></p-sortIcon></th>
            <th pSortableColumn="categoria">Categoria <p-sortIcon field="categoria"></p-sortIcon></th>
            <th pSortableColumn="valor">Valor <p-sortIcon field="valor"></p-sortIcon></th>
            <th pSortableColumn="data">Data <p-sortIcon field="data"></p-sortIcon></th>
            <th>Forma</th>
            <th>Recorrente</th>
            <th>Observações</th>
            <th>Ações</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>{{ item.descricao }}</td>
            <td>{{ item.categoria }}</td>
            <td>R$ {{ item.valor | number : '1.2-2' }}</td>
            <td>{{ item.data }}</td>
            <td>{{ item.formaRecebimento }}</td>
            <td>
              <p-tag [value]="item.recorrente ? 'Sim' : 'Não'" [severity]="item.recorrente ? 'success' : 'secondary'"></p-tag>
            </td>
            <td>{{ item.observacoes }}</td>
            <td class="actions">
              <button pButton type="button" label="Editar" [style.width.px]="110" (click)="edit(item)"></button>
              <button pButton type="button" severity="danger" label="Excluir" [style.width.px]="110" (click)="remove(item)"></button>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Nenhuma receita encontrada para o período.</td>
          </tr>
        </ng-template>
      </p-table>
    </section>
  </div>
</div>
